# Firebase Integration Documentation

## Overview
Grocery App Flutter telah berhasil diintegrasikan dengan Firebase untuk authentication dan data storage menggunakan Firestore.

## Setup Configuration

### 1. Firebase Initialization
- **File**: `lib/firebase_options.dart`
- **Platform Support**: Android, iOS, macOS, Windows, Web
- **Initialization Point**: `lib/main.dart` - `void main()` async function

```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(const GroceryApp());
}
```

### 2. Auth State Management
- **Authentication Source**: `FirebaseAuth.instance.authStateChanges()`
- **Routing Logic**: StreamBuilder in GroceryApp
  - Logged In â†’ RootShell (Main App)
  - Logged Out â†’ LoginScreen

## Features Implemented

### Authentication (lib/login_screen.dart)

#### Login Screen
- **Method**: Email & Password
- **Firebase Function**: `FirebaseAuth.instance.signInWithEmailAndPassword()`
- **Error Handling**: Try-catch with SnackBar feedback
- **Loading State**: CircularProgressIndicator

#### Register Screen
- **Method**: Email & Password with Full Name
- **Firebase Functions**:
  1. `FirebaseAuth.instance.createUserWithEmailAndPassword()`
  2. `FirebaseFirestore.instance.collection('users').doc(uid).set()`
- **Firestore Data Saved**:
  ```json
  {
    "fullName": "User's Full Name",
    "email": "user@example.com",
    "createdAt": "Firestore Timestamp"
  }
  ```
- **Validation**: Password match, required fields
- **Feedback**: SnackBar on success/failure

### User Data Management

#### Homepage (lib/pages/homepage.dart)
- **Real-time Greeting**: "Hi, [User Full Name] ðŸ‘‹"
- **Data Source**: Firestore `users` collection
- **Implementation**: `StreamBuilder<DocumentSnapshot>`
- **Fallback**: "User" if data not found

#### Profile Page (lib/pages/profile.dart)
- **Header Display**: Real user data from Firestore
- **Data Shown**: Full Name, Email
- **Real-time Sync**: StreamBuilder for live updates

#### Edit Profile (lib/pages/profile.dart)
- **READ**: Load fullName on page open via `_loadUserData()`
- **UPDATE**: Save changes to Firestore via `.update()` method
- **Feedback**: Success/error SnackBar

### Logout (lib/pages/profile.dart)
- **Function**: `FirebaseAuth.instance.signOut()`
- **Behavior**: Auto redirect to SplashScreen via StreamBuilder
- **Side Effects**: User state changes trigger app re-routing

## Firestore Database Structure

```
firebaseproject/
â””â”€â”€ users (collection)
    â””â”€â”€ {uid} (document - Auto-generated by Firebase)
        â”œâ”€â”€ fullName: String
        â”œâ”€â”€ email: String
        â””â”€â”€ createdAt: Timestamp
```

## Dependencies Added

```yaml
firebase_core: ^4.2.1
firebase_auth: ^6.1.2
cloud_firestore: ^6.1.0
```

## Files Modified

| File | Changes |
|------|---------|
| `pubspec.yaml` | Updated SDK environment to `>=3.0.0 <4.0.0` |
| `lib/main.dart` | Added Firebase init, StreamBuilder auth gate |
| `lib/firebase_options.dart` | Created with platform configs |
| `lib/login_screen.dart` | Firebase signIn/signUp with Firestore storage |
| `lib/pages/homepage.dart` | Added real-time greeting from Firestore |
| `lib/pages/profile.dart` | Added logout, edit profile, real-time data sync |
| `android/app/google-services.json` | Copied from android/ root |

## Build & Deployment

### Android
- Requires: `google-services.json` in `android/app/`
- Build Command: `flutter build apk --debug`

### iOS
- Requires: Firebase pod configuration
- Build Command: `flutter build ios`

### Web
- Requires: Firebase web credentials in `firebase_options.dart`
- Build Command: `flutter build web`

## Testing Checklist

- [ ] Sign Up with new account (check Firestore)
- [ ] Sign In with existing account
- [ ] Homepage shows correct user greeting
- [ ] Edit Profile updates fullName in Firestore
- [ ] Logout redirects to LoginScreen
- [ ] Auth state persists on app restart
- [ ] Error messages display on failed auth

## Notes

- All user IDs use Firebase Auth UID as Firestore document ID
- Timestamps are server-generated by Firestore
- Real-time listeners use StreamBuilder for optimal UX
- Auth state changes automatically trigger UI updates
